{"ast":null,"code":"import { v4 as uuid } from \"uuid\";\nimport loginService from \"../services/login\";\nimport { CONSTANTS } from \"../static/constants\";\nimport { setToken, destroyToken } from \"../utils/tokenHelper\";\nimport userService from \"../services/user\";\nimport dashboardService from \"../services/dashboard\";\nconst initialState = {\n  isFetching: true,\n  data: {}\n};\n\nconst userReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"USER_REQUEST\":\n      return { ...state,\n        isFetching: true\n      };\n\n    case \"USER_REQUEST_FAIL\":\n      return { ...state,\n        isFetching: false\n      };\n\n    case \"SET_USER\":\n      return {\n        isFetching: false,\n        data: action.data\n      };\n\n    case \"CLEAR_USER\":\n      return {\n        isFetching: false,\n        data: {}\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport const initUser = () => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      const loggedUserJSON = window.localStorage.getItem(\"loggedUser\");\n\n      if (loggedUserJSON) {\n        const user = JSON.parse(loggedUserJSON);\n        setToken(user.token);\n        dispatch({\n          type: \"SET_MESSAGES\",\n          messages: user.messagesRead\n        });\n        dispatch({\n          type: \"SET_USER\",\n          data: user\n        });\n        const dashboards = await dashboardService.getAllDash();\n        dispatch({\n          type: \"INIT_DASHBOARDS\",\n          data: dashboards\n        });\n      } else {\n        dispatch({\n          type: \"USER_REQUEST_FAIL\"\n        });\n      }\n    } catch (e) {\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport const demoUser = () => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      const user = CONSTANTS.DEMOTOKEN;\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      setToken(user.token);\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user\n      });\n      const dashboards = await dashboardService.getAllDash();\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards\n      });\n    } catch (e) {\n      console.log(e);\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e,\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport const createUser = (email, password, checkPassword) => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      await userService.create({\n        email,\n        password,\n        checkPassword\n      });\n      const user = await loginService.login({\n        email,\n        password\n      });\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      setToken(user.token);\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user\n      });\n      const dashboards = await dashboardService.getAllDash();\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: `Account created`,\n          type: CONSTANTS.NOTIFICATION.SUCCESS\n        }\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\"\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport const logoutUser = () => {\n  return async dispatch => {\n    destroyToken();\n    window.localStorage.removeItem(\"loggedUser\");\n    dispatch({\n      type: \"CLEAR_USER\"\n    });\n    dispatch({\n      type: \"SET_NOTIFICATION\",\n      content: {\n        id: uuid(),\n        message: \"Logged Out\",\n        type: CONSTANTS.NOTIFICATION.SUCCESS\n      }\n    });\n  };\n};\nexport const loginUser = (email, password) => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      const user = await loginService.login({\n        email,\n        password\n      });\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      setToken(user.token);\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user\n      });\n      const dashboards = await dashboardService.getAllDash();\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards\n      });\n    } catch (e) {\n      console.log(e);\n      dispatch({\n        type: \"USER_REQUEST_FAIL\"\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: \"wrong email or password\",\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport const updateUser = (newEmail, oldPassword, newPassword, confirmNewPassword, id) => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      const user = await userService.update(newEmail, oldPassword, newPassword, confirmNewPassword, id);\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      destroyToken();\n      setToken(user.token);\n      dispatch({\n        type: \"SET_USER\",\n        data: user\n      });\n      const dashboards = await dashboardService.getAllDash();\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\"\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport const deleteUser = (password, id) => {\n  return async dispatch => {\n    dispatch({\n      type: \"USER_REQUEST\"\n    });\n\n    try {\n      await userService.deleteUser(password, id);\n      window.localStorage.removeItem(\"loggedUser\");\n      destroyToken();\n      dispatch({\n        type: \"CLEAR_USER\"\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\"\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR\n        }\n      });\n    }\n  };\n};\nexport default userReducer;","map":{"version":3,"sources":["/home/james/development/property-investor-dash/client/src/reducers/userReducer.js"],"names":["v4","uuid","loginService","CONSTANTS","setToken","destroyToken","userService","dashboardService","initialState","isFetching","data","userReducer","state","action","type","initUser","dispatch","loggedUserJSON","window","localStorage","getItem","user","JSON","parse","token","messages","messagesRead","dashboards","getAllDash","e","content","id","message","response","error","NOTIFICATION","ERROR","demoUser","DEMOTOKEN","setItem","stringify","console","log","createUser","email","password","checkPassword","create","login","SUCCESS","logoutUser","removeItem","loginUser","updateUser","newEmail","oldPassword","newPassword","confirmNewPassword","update","deleteUser"],"mappings":"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","sourcesContent":["import { v4 as uuid } from \"uuid\";\nimport loginService from \"../services/login\";\nimport { CONSTANTS } from \"../static/constants\";\nimport { setToken, destroyToken } from \"../utils/tokenHelper\";\nimport userService from \"../services/user\";\nimport dashboardService from \"../services/dashboard\";\n\nconst initialState = { isFetching: true, data: {} };\n\nconst userReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"USER_REQUEST\":\n      return { ...state, isFetching: true };\n    case \"USER_REQUEST_FAIL\":\n      return { ...state, isFetching: false };\n    case \"SET_USER\":\n      return {\n        isFetching: false,\n        data: action.data,\n      };\n    case \"CLEAR_USER\":\n      return { isFetching: false, data: {} };\n    default:\n      return state;\n  }\n};\n\nexport const initUser = () => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      const loggedUserJSON = window.localStorage.getItem(\"loggedUser\");\n\n      if (loggedUserJSON) {\n        const user = JSON.parse(loggedUserJSON);\n        setToken(user.token);\n        dispatch({\n          type: \"SET_MESSAGES\",\n          messages: user.messagesRead,\n        });\n        dispatch({\n          type: \"SET_USER\",\n          data: user,\n        });\n\n        const dashboards = await dashboardService.getAllDash();\n\n        dispatch({\n          type: \"INIT_DASHBOARDS\",\n          data: dashboards,\n        });\n      } else {\n        dispatch({\n          type: \"USER_REQUEST_FAIL\",\n        });\n      }\n    } catch (e) {\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport const demoUser = () => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      const user = CONSTANTS.DEMOTOKEN;\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      setToken(user.token);\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead,\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user,\n      });\n\n      const dashboards = await dashboardService.getAllDash();\n\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards,\n      });\n    } catch (e) {\n      console.log(e);\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e,\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport const createUser = (email, password, checkPassword) => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      await userService.create({\n        email,\n        password,\n        checkPassword,\n      });\n\n      const user = await loginService.login({\n        email,\n        password,\n      });\n\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n\n      setToken(user.token);\n\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead,\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user,\n      });\n\n      const dashboards = await dashboardService.getAllDash();\n\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards,\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: `Account created`,\n          type: CONSTANTS.NOTIFICATION.SUCCESS,\n        },\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\",\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport const logoutUser = () => {\n  return async (dispatch) => {\n    destroyToken();\n    window.localStorage.removeItem(\"loggedUser\");\n    dispatch({\n      type: \"CLEAR_USER\",\n    });\n    dispatch({\n      type: \"SET_NOTIFICATION\",\n      content: {\n        id: uuid(),\n        message: \"Logged Out\",\n        type: CONSTANTS.NOTIFICATION.SUCCESS,\n      },\n    });\n  };\n};\n\nexport const loginUser = (email, password) => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      const user = await loginService.login({\n        email,\n        password,\n      });\n\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      setToken(user.token);\n\n      dispatch({\n        type: \"SET_MESSAGES\",\n        messages: user.messagesRead,\n      });\n      dispatch({\n        type: \"SET_USER\",\n        data: user,\n      });\n\n      const dashboards = await dashboardService.getAllDash();\n\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards,\n      });\n    } catch (e) {\n      console.log(e);\n      dispatch({\n        type: \"USER_REQUEST_FAIL\",\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: \"wrong email or password\",\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport const updateUser = (\n  newEmail,\n  oldPassword,\n  newPassword,\n  confirmNewPassword,\n  id\n) => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      const user = await userService.update(\n        newEmail,\n        oldPassword,\n        newPassword,\n        confirmNewPassword,\n        id\n      );\n\n      window.localStorage.setItem(\"loggedUser\", JSON.stringify(user));\n      destroyToken();\n      setToken(user.token);\n\n      dispatch({\n        type: \"SET_USER\",\n        data: user,\n      });\n\n      const dashboards = await dashboardService.getAllDash();\n\n      dispatch({\n        type: \"INIT_DASHBOARDS\",\n        data: dashboards,\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\",\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport const deleteUser = (password, id) => {\n  return async (dispatch) => {\n    dispatch({\n      type: \"USER_REQUEST\",\n    });\n    try {\n      await userService.deleteUser(password, id);\n\n      window.localStorage.removeItem(\"loggedUser\");\n      destroyToken();\n\n      dispatch({\n        type: \"CLEAR_USER\",\n      });\n    } catch (e) {\n      dispatch({\n        type: \"USER_REQUEST_FAIL\",\n      });\n      dispatch({\n        type: \"SET_NOTIFICATION\",\n        content: {\n          id: uuid(),\n          message: e.response.data.error,\n          type: CONSTANTS.NOTIFICATION.ERROR,\n        },\n      });\n    }\n  };\n};\n\nexport default userReducer;\n"]},"metadata":{},"sourceType":"module"}